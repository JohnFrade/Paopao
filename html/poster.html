<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta name="x5-page-mode" content="app">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/poster.css">
    <!-- <script type="text/javascript" src="http://cdn.webfont.youziku.com/wwwroot/js/wf/youziku.api.min.js"></script> -->
    <script type="text/javascript">
        // $youziku.load("body", "9b87ae83ef31495cbf960577280c68b5", "ljsh");
        /*$youziku.load("#id1,.class1,h1", "9b87ae83ef31495cbf960577280c68b5", "ljsh");*/
        /*．．．*/
        // $youziku.draw();
     </script>
    <title>日签卡</title>
</head>
<body>
    <div id="global-wrapper">
        <button class="global-btn poster-rules">规则</button>
        <div class="poster-wrapper">
            <img src="" class="global-img"/>
            <canvas id="posterCanvas"></canvas>
        </div>
        <p class="poster-tips">长按保存图片，分享给朋友</p>
        <button class="global-btn global-btn-round-lg poster-btn">修改图片/重置默认图</button>
    </div>
</body>
    <script>
        var imgArr = ['https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=3819545867,2119749480&fm=26&gp=0.jpg','19']
        // 加载图片
        function preLoadImg(arr) {
            arr = (typeof arr != "object") ? [arr] : arr;
            var newImgs = [],
                loadIndex = 0;
            var loadDone = function () {}
            function loadCount(){
                loadIndex++;
                if(loadIndex === arr.length){
                    loadDone(newImgs)
                }
            }
            for(var i = 0;i = arr.length;i++){
                newImgs[i] = new Image();
                newImgs[i].src = arr[i]
                newImgs[i].onload = function() {
                    loadCount()
                }
                newImgs[i].onerror = function(){
                    loadCount()
                }
            }
            return {
                all:function(f){
                    loadDone = f || loadDone
                }
            }
            
        }
        // 获取缩放比例
        function getBasePixal() {
            var winW = document.documentElement.clientWidth;
            winW = winW >= 640?640:winW;
            if(winW >= 320){
                return 10
            }else if(winW >= 360){
                return 12
            }else if(winW >= 414){
                return 14
            }else if(windW >= 480){
                return 16
            }
        }
        // 获取canvas的尺寸
        function getCanvasSize(parentEle) {
            if(!!ele) return false;
            var ele = document.querySelector(parentEle);
            return {
                w:ele.offsetWidth*2,
                h:ele.offsetHeight*2
            }
        }
        // 绘制海报
        function drawPoster(parentEle,imgArr) {
            var canvas = document.getElementById("posterCanvas");
            var ctx = canvas.getContext("2d");
            
            // 获取父级的尺寸
            var parent = getCanvasSize(parentEle);
            console.log(parent)
            var fontSize = getBasePixal();

            canvas.setAttribute("width",parent.w+20);
            canvas.setAttribute("height",parent.h+20)

            canvas.style.width = parent.w/2 + 'px';
            canvas.style.height = parent.h/2 + 'px';

            //绘制阴影
            ctx.fillStyle = '#fff';
            ctx.shadowColor='rgba(0,0,0,.1)';
            ctx.shadowBlur='15';
            ctx.fillRect(10,10,parent.w,parent.h);
            
            // 绘制边框
            ctx.strokeStyle = '#61ABFF';
            ctx.lineWidth = (8/260)*parent.w;
            ctx.strokeRect(10,10,parent.w,parent.h);
            ctx.stroke();

            // 绘制banner
            ctx.drawImage(this.banner, (8/260)*parent.w, (8/260)*parent.w, (252/260)*parent.w, (252/260)*parent.w)

            // 绘制
        }

        preLoadImg().all(function(imgArr) {
            console.log(imgArr)
            drawPoster('.poster-wrapper',imgArr)
        })
        

        // 将canvas图片转换成base64
    </script>
</html>