<!DOCTYPE html>
<html lang="en">

    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <meta name="x5-page-mode" content="app">
        <link rel="stylesheet" href="../css/common.css">
        <link rel="stylesheet" href="../css/my.css">
        <link rel="stylesheet" href="../css/footer.css">
        <title>我的</title>
    </head>

    <body>
        <div id="global-wrapper" class="anim">
            <header id="header" class="global-bg-fff">
                <div class="my-info global-relative">
                    <figure class="global-flex global-flex-center">
                        <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                            class="my-avatar">
                        <figcaption style="width:15rem">
                            <div class="my-username-wrapper global-flex global-flex-center">
                                <div class="my-username font-ellipsis font-ellipsis-1">xxxxxx</div>
                                <div class="global-vip-signs"></div>
                            </div>
                            <div class="font-12 font-999" style="margin-bottom:1rem">UID:451550</div>
                            <div class="global-flex global-flex-center">
                                <a href="./my-data.html" class="font-999 font-14">编辑个人资料</a>
                                <div class="global-btn data-progress">100%</div>
                            </div>
                        </figcaption>
                    </figure>
                    <button class="global-btn my-album-btn">相册</button>
                </div>
                <nav class="global-flex my-nav-list global-border global-border-bottom">
                    <li class="global-flex-1 my-nav-item">
                        <p class="my-nav-item-data">24</p>
                        <p class="font-999">好友</p>
                    </li>
                    <li class="global-flex-1 my-nav-item">
                        <p class="my-nav-item-data">24</p>
                        <p class="font-999">关注</p>
                    </li>
                    <li class="global-flex-1 my-nav-item">
                        <p class="my-nav-item-data">24</p>
                        <p class="font-999">暗恋我的</p>
                    </li>
                    <li class="global-flex-1 my-nav-item">
                        <p class="my-nav-item-data global-relative">
                            24<sup class="new-visit-tips font-red">•</sup>
                        </p>
                        <p class="font-999">
                            访客
                        </p>
                    </li>
                </nav>
                <!-- 会员卡 -->
                <section id="vip-card" class="vip-card-wrapper">
                    <!-- 整个卡片都可以点击 -->
                    <a href="./vip-charge.html" class="vip-card global-relative">
                        <img src="../img//vip-card.png" class="global-img">
                        <!-- 开通会员 续费会员-->
                        <button class="global-btn open-vip-btn">开通会员</button>
                    </a>
                </section>
            </header>
            <main id="main">
                <!-- 个人动态 -->
                <section class="my-active-news-wrapper global-flex global-flex-center global-border global-border-top">
                    <div class="font-bold font-14 my-active-news-block-name">
                        个人动态
                    </div>
                    <!-- 最多显示三张 -->
                    <ul class="my-active-news-list global-flex">
                        <li class="my-active-news-item">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                                class="global-img">
                        </li>
                        <li class="my-active-news-item">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                                class="global-img">
                        </li>
                        <li class="my-active-news-item">
                            <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                                class="global-img">
                        </li>
                    </ul>
                    <div class="my-active-news-item" style="display:none">
                        <img src="" class="global-img">
                    </div>
                    <div class="global-align-right font-12 font-999" style="padding-right:1rem">63动态</div>
                    <svg class="icon-arrow-right" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                    </svg>
                </section>
                <section>
                    <ul class="my-list">
                        <li class="my-item-wrapper">
                            <a href="" class="my-item global-flex">
                                <svg class="icon-my-item" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-my-page"></use>
                                </svg>
                                个人主页
                                <svg class="icon-arrow-right" aria-hidden="true">
                                    <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="my-item-wrapper">
                            <a href="" class="my-item global-flex global-flex-center">
                                <svg class="icon-my-item" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-chat"></use>
                                </svg>
                                私聊信息
                                <span class="global-align-right font-bold font-red gap-right">•</span>
                                <svg class="icon-arrow-right" aria-hidden="true">
                                    <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="my-item-wrapper">
                            <a href="" class="my-item global-flex global-flex-center">
                                <svg class="icon-my-item" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-apply-cash"></use>
                                </svg>
                                <div class="my-text-center">申请提现</div>
                                <div class="global-align-right font-red gap-right my-text-center">9.55元</div>
                                <svg class="icon-arrow-right" aria-hidden="true">
                                    <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="my-item-wrapper">
                            <a href="" class="my-item global-flex global-flex-center">
                                <svg class="icon-my-item" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-my-order"></use>
                                </svg>
                                <span class="my-text-center">我的订单</span>
                                <svg class="icon-arrow-right" aria-hidden="true">
                                    <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="my-item-wrapper">
                            <a href="" class="my-item global-flex global-flex-center">
                                <svg class="icon-my-item" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-setting"></use>
                                </svg>
                                个人设置
                                <svg class="icon-arrow-right" aria-hidden="true">
                                    <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="my-item-wrapper">
                            <a href="" class="my-item global-flex global-flex-center">
                                <svg class="icon-my-item" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-weskit"></use>
                                </svg>
                                马甲设置
                                <svg class="icon-arrow-right" aria-hidden="true">
                                    <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                </svg>
                            </a>
                        </li>
                    </ul>
                </section>
            </main>
        </div>
        <footer id="footer">
            <nav class="global-flex footer-item-wrapper">
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-index"></use>
                    </svg>
                    <p>首页</p>
                </li>
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-date"></use>
                    </svg>
                    <p>相亲</p>
                </li>
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-rank"></use>
                    </svg>
                    <p>排行榜</p>
                </li>
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-active footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-my"></use>
                    </svg>
                    <p>我的</p>
                </li>
            </nav>
        </footer>
    </body>
    <script>
        (function () {
            if (!window.requestAnimationFrame) { //兼容requestAnimationFrame
                window.requestAnimationFrame = function (callback) {
                    var currTime = new Date().getTime();
                    var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
                    var timer = window.setTimeout(function () {
                        callback(currTime + timeToCall);
                    }, timeToCall);
                    lastTime = currTime + timeToCall;
                    return timer
                };
            }
            if (!window.cancelAnimationFrame) {
                window.cancelAnimationFrame = function (timer) {
                    clearTimeout(timer)
                };
            }
        })();

        function footerLink() {
            var footerList = Array.prototype.slice.call(document.querySelectorAll('.footer-item'))
            url = ''
            footerList.forEach(function (item, index) {
                item.onclick = function () {
                    if (index === 0) {
                        url = 'http://192.168.10.227:3000/html/index.html'
                    } else if (index === 1) {

                    } else if (index === 2) {

                    } else if (index === 3) {
                        url = 'http://192.168.10.227:3000/html/my.html'
                    }
                    window.open(url)
                }
            })
        }
        footerLink()

        // 禁止header滚动
        function hideWrapperScroll(el) {
            el.addEventListener('touchmove', function (e) {
                e.stopPropagation()
                if (el.scrollTop === 0) {
                    e.preventDefault();
                    return false
                }
            })
        }

        //触摸显示会员卡
        function showVipCard() {
            // 布尔值控制会员卡
            // if (isShow) {
            const wrapper = document.querySelector('#global-wrapper')
            hideWrapperScroll(wrapper)
            const el = document.querySelector('#main');
            var timer = null,
                bounce = false,
                touchEndP = 0, // 触摸的终点位置
                startY = 0, // 起始触摸的位置
                deltaY = 0, // 竖直触摸的距离
                cardH = document.querySelector('#vip-card').offsetHeight;
            var cardTranslateY = cardH * (-.645);
            
            // 如果用Vue放在页面渲染完成之后执行showVipCard这个方法
            setTimeout(() => {
                el.style.cssText = 'transform:translateY(' + cardTranslateY + 'px)'
            }, 850)

            el.addEventListener('touchstart', function (e) {
                startY = e.changedTouches[0].pageY;
            }, false)

            // 监听滚动方向
            el.addEventListener('touchmove', function (e) {
                e.stopPropagation();
                deltaY = e.changedTouches[0].pageY - startY;
                // 向上滚动
                if (deltaY > 0) {
                    if (wrapper.scrollTop === 0) {
                        if (deltaY >= cardH * 1.1) {
                            deltaY = cardH * 1.1
                        }
                        touchEndP = cardTranslateY + deltaY * .585;
                        el.style.cssText = 'transform:translateY(' + touchEndP + 'px)'
                        e.preventDefault();
                        return false
                    }
                }
            }, false)
            // 触摸结束复位
            el.addEventListener('touchend', function (e) {
                if (deltaY > 15 && wrapper.scrollTop === 0) {
                    timer = requestAnimationFrame(function fn() {
                        if (touchEndP >= cardTranslateY - 28 && !bounce) {
                            touchEndP += -28;
                            el.style.cssText = 'transform:translateY(' + touchEndP + 'px)'
                            // 大于卡片的高度才使用回弹
                            if (deltaY > cardH) {
                                if (touchEndP <= cardTranslateY - 28) {
                                    bounce = true
                                }
                            }
                            timer = requestAnimationFrame(fn)
                        } else if (touchEndP < cardTranslateY && bounce) {
                            touchEndP += 1.125;
                            el.style.cssText = 'transform:translateY(' + touchEndP + 'px)'
                            timer = requestAnimationFrame(fn)
                        } else {
                            bounce = false
                            el.style.cssText = 'transform:translateY(' + cardTranslateY + 'px)'
                            cancelAnimationFrame(timer)
                        }
                    })
                }
            }, false)
        }
        showVipCard()
    </script>

</html>