<!DOCTYPE html>
<html lang="en">

    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <meta content="telephone=no" name="format-detection">
        <meta content="email=no" name="format-detection">
        <meta name="x5-page-mode" content="app">
        <link rel="stylesheet" href="../css/common.css">
        <link rel="stylesheet" href="../css/my.css">
        <link rel="stylesheet" href="../css/footer.css">
        <title>我的</title>
    </head>

    <body>
        <div id="global-wrapper" class="anim">
            <header id="header" class="global-bg-fff global-relative">
                <div class="my-info global-relative">
                    <figure class="global-flex global-flex-center">
                        <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                            class="my-avatar mask-click">
                        <figcaption style="width:15rem">
                            <div class="my-username-wrapper global-flex global-flex-center">
                                <div class="my-username font-ellipsis font-ellipsis-1">xxxxxx</div>
                                <div class="global-vip-signs"></div>
                            </div>
                            <div class="font-12 font-999" style="margin-bottom:1.5rem">UID:451550</div>
                            <a href="./my-data.html" class="global-flex global-flex-center font-999 font-14 mask-click">
                                <svg class="icon-edit" aria-hidden="true">
                                    <use xlink:href="../img/my.svg#icon-edit"></use>
                                </svg>
                                编辑个人资料
                            </a>
                        </figcaption>
                    </figure>
                    <button class="global-btn my-album-btn mask-click" onclick="goToAlum()">相册</button>
                </div>
                <nav class="global-flex my-nav-list">
                    <a class="global-flex-1 my-nav-item mask-click" href="www.baidu.com">
                        <p class="my-nav-item-data">24</p>
                        <p class="font-999">好友</p>
                    </a>
                    <a class="global-flex-1 my-nav-item mask-click">
                        <p class="my-nav-item-data">24</p>
                        <p class="font-999">关注</p>
                    </a>
                    <a class="global-flex-1 my-nav-item mask-click">
                        <p class="my-nav-item-data">24</p>
                        <p class="font-999">暗恋我的</p>
                    </a>
                    <a class="global-flex-1 my-nav-item mask-click">
                        <p class="my-nav-item-data">
                            24
                        </p>
                        <p class="font-999 global-relative">
                            访客<sup class="new-visit-tips font-red">•</sup>
                        </p>
                    </a>
                </nav>
                <!-- 会员卡 -->
                <!-- style="display:none" -->
                <section id="vip-card" class="vip-card-wrapper">
                    <!-- 整个卡片都可以点击 -->
                    <a href="./vip-charge.html" class="vip-card global-relative mask-click">
                        <img src="../img/vip-card.png" class="global-img">
                        <!-- 开通会员open-vip-btn 续费会员 renew-btn-->
                        <button class="global-btn my-vip-btn open-vip-btn">开通会员</button>
                        <div class="vip-time">过期：2019.01.15</div>
                    </a>
                </section>
            </header>
            <main id="main">
                <section class="hide-mask">
                </section>
                <!-- no-vip -->
                <div id="main-content" class="anim">
                    <!-- 个人动态 -->
                    <section class="my-active-news-wrapper global-flex global-flex-center global-border global-border-top">
                        <div class="font-bold font-14 my-active-news-block-name">
                            个人动态
                        </div>
                        <!-- 最多显示三张 -->
                        <ul class="my-active-news-list global-flex">
                            <li class="my-active-news-item">
                                <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                                    class="global-img">
                            </li>
                            <li class="my-active-news-item">
                                <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                                    class="global-img">
                            </li>
                            <li class="my-active-news-item">
                                <img src="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1543333345155&di=1ed82f3b374af9b7eb988123bea26d8b&imgtype=0&src=http%3A%2F%2Fuploads.5068.com%2Fallimg%2F1801%2F151P42a2-4.jpg"
                                    class="global-img">
                            </li>
                        </ul>
                        <div class="my-active-news-item" style="display:none">
                            <img src="" class="global-img">
                        </div>
                        <div class="global-align-right font-12 font-999" style="padding-right:1rem">63动态</div>
                        <svg class="icon-arrow-right" aria-hidden="true">
                            <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                        </svg>
                    </section>
                    <section>
                        <ul class="my-list">
                            <li class="my-item-wrapper">
                                <a href="./personal-home-page.html" class="my-item global-flex">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-my-page"></use>
                                    </svg>
                                    个人主页
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-chat"></use>
                                    </svg>
                                    私聊信息
                                    <span class="global-align-right font-bold font-red gap-right">•</span>
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <!-- <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-my-news"></use>
                                    </svg>
                                    我的消息
                                    <span class="global-align-right font-bold font-red gap-right">•</span>
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li> -->
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-apply-cash"></use>
                                    </svg>
                                    <div class="my-text-center">申请提现</div>
                                    <div class="global-align-right font-red gap-right">9.55元</div>
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-red-pocket"></use>
                                    </svg>
                                    <span class="my-text-center">红包</span>
                                    <p class="global-align-right font-red gap-right">邀请新用户获取红包</p>
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-matchmaker"></use>
                                    </svg>
                                    <span class="my-text-center">我的媒婆店</span>
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-my-order"></use>
                                    </svg>
                                    <span class="my-text-center">我的订单</span>
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-setting"></use>
                                    </svg>
                                    个人设置
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                            <li class="my-item-wrapper">
                                <a href="" class="my-item global-flex global-flex-center">
                                    <svg class="icon-my-item" aria-hidden="true">
                                        <use xlink:href="../img/my.svg#icon-weskit"></use>
                                    </svg>
                                    马甲设置
                                    <svg class="icon-arrow-right" aria-hidden="true">
                                        <use xlink:href="../img/global.svg#icon-arrow-right"></use>
                                    </svg>
                                </a>
                            </li>
                        </ul>
                    </section>
                </div>
            </main>
        </div>
        <footer id="footer">
            <nav class="global-flex footer-item-wrapper">
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-index"></use>
                    </svg>
                    <p>首页</p>
                </li>
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-date"></use>
                    </svg>
                    <p>相亲</p>
                </li>
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-rank"></use>
                    </svg>
                    <p>排行榜</p>
                </li>
                <li class="global-flex-1 global-flex global-flex-justify-center global-flex-column footer-active footer-item">
                    <svg class="icon-footer" aria-hidden="true">
                        <use xlink:href="../img/global.svg#icon-my"></use>
                    </svg>
                    <p>我的</p>
                </li>
            </nav>
        </footer>
        <!-- show-invited -->
        <a href="javascript:void(0);" class="my-invited">
            <img src="../img/invite-red.png" class="global-img">
        </a>
    </body>
    <script>
        (function () {
            if (!window.requestAnimationFrame) { //兼容requestAnimationFrame
                window.requestAnimationFrame = function (callback) {
                    var currTime = new Date().getTime();
                    var timeToCall = Math.max(0, 16.7 - (currTime - lastTime));
                    var timer = window.setTimeout(function () {
                        callback(currTime + timeToCall);
                    }, timeToCall);
                    lastTime = currTime + timeToCall;
                    return timer
                };
            }
            if (!window.cancelAnimationFrame) {
                window.cancelAnimationFrame = function (timer) {
                    clearTimeout(timer)
                };
            }
        })();

        function goToAlum() {
            window.location.href = './album.html'
        }


        function footerLink() {
            var footerList = Array.prototype.slice.call(document.querySelectorAll('.footer-item'))
            url = ''
            footerList.forEach(function (item, index) {
                item.onclick = function () {
                    if (index === 0) {
                        url = './index.html'
                    } else if (index === 1) {
                        url = './dating.html'
                    } else if (index === 2) {

                    } else if (index === 3) {
                        url = './my.html'
                    }
                    window.open(url)
                }
            })
        }
        footerLink()

        // 禁止header滚动
        function hideWrapperScroll(el) {
            el.addEventListener('touchmove', function (e) {
                e.stopPropagation()
                if (el.scrollTop === 0) {
                    e.preventDefault();
                    return false
                }
            })
        }

        //触摸显示会员卡
        function showVipCard(isShow) {
            // 布尔值控制会员卡
            if (isShow) {
                const wrapper = document.querySelector('#main')
                hideWrapperScroll(wrapper)
                // const el = document.querySelector('#main');
                const el = document.querySelector('#main-content')
                var timer = null,
                    beforeDeltaY = 0,
                    bounce = false,
                    step = 0,
                    step = 0,
                    touchEndP = 0, // 触摸的终点位置
                    startY = 0, // 起始触摸的位置
                    deltaY = 0, // 竖直触摸的距离
                    cardH = document.querySelector('#vip-card').offsetHeight;
                var cardTranslateY = cardH * (-.645);

                // 如果用Vue放在页面渲染完成之后执行showVipCard这个方法
                el.style.cssText = 'transform:translateY(' + cardTranslateY + 'px)';
                var foldTimer = requestAnimationFrame(function fn() {
                    if (step < 29) {
                        ++step;
                        requestAnimationFrame(fn)
                    } else {
                        step = 0;
                        document.querySelector('.my-invited').classList.add('show-invited');
                        cancelAnimationFrame(foldTimer)
                    }
                })
                el.addEventListener('touchstart', function (e) {
                    if (wrapper.scrollTop == 0) {
                        date = +new Date();
                        cancelAnimationFrame(timer)
                        startY = e.changedTouches;
                    }
                }, false)

                // 监听滚动方向
                el.addEventListener('touchmove', function (e) {
                    e.stopPropagation();
                    if (wrapper.scrollTop == 0) {
                        if (startY.length < 2) {
                            deltaY = e.changedTouches[0].pageY - startY[0].pageY;
                        } else {
                            for (var i = 0, len = e.changedTouches.length; i < len; i++) {
                                if (distance > 0) {
                                    deltaY += e.changedTouches[i].pageY - startY[i].pageY;
                                }
                            }
                        }
                        if (deltaY > 0) {
                            e.preventDefault();
                            if (+new Date() - date >= 16.7) {
                                // 向上滚动
                                if (deltaY >= 10) {
                                    touchEndP = cardTranslateY + deltaY * (startY.length >= 2 ? .128 : .684);
                                    el.style.cssText = 'transform:translateY(' + touchEndP + 'px)';
                                }
                                date = +new Date();
                            }
                        }
                    }

                }, false)
                // 触摸结束复位
                el.addEventListener('touchend', function (e) {
                    if (deltaY >= 10 && wrapper.scrollTop === 0 && +new Date() - date >= 10) {
                        timer = requestAnimationFrame(function fn() {
                            if (touchEndP >= cardTranslateY - 24 && !bounce) {
                                // 大于卡片的高度才使用回弹
                                if (deltaY > cardH) {
                                    if (touchEndP <= cardTranslateY) {
                                        touchEndP += -2.24;
                                        if (touchEndP <= cardTranslateY - 24) {
                                            bounce = true
                                        }
                                    } else {
                                        touchEndP += -6.84;
                                    }
                                } else {
                                    if (touchEndP >= cardTranslateY) {
                                        touchEndP += -4.64;
                                    } else {
                                        bounce = false
                                        el.style.cssText = 'transform:translateY(' + cardTranslateY +
                                            'px)';
                                        cancelAnimationFrame(timer)
                                    }
                                }
                                el.style.cssText = 'transform:translateY(' + touchEndP + 'px)'

                                requestAnimationFrame(fn)
                            } else if (touchEndP < cardTranslateY && bounce) {
                                touchEndP += .925;
                                el.style.cssText = 'transform:translateY(' + touchEndP + 'px)'
                                requestAnimationFrame(fn)
                            } else {
                                bounce = false
                                el.style.cssText = 'transform:translateY(' + cardTranslateY + 'px)';
                                cancelAnimationFrame(timer)
                            }
                        })
                    }
                }, false)
            }
        }
        showVipCard(1)


            function maskClick() {
                var mask = document.querySelector('.hide-mask');
                var nodeArr = Array.prototype.slice.call(document.querySelectorAll('.mask-click'));
                var getNodeArr = nodeArr.reduce(function (prev, cur, index) {
                    var arr = [];
                    arr.push(nodeArr[index].offsetLeft)
                    arr.push(nodeArr[index].offsetTop)
                    arr.push(nodeArr[index].offsetLeft + nodeArr[index].offsetWidth)
                    arr.push(nodeArr[index].offsetTop + nodeArr[index].offsetHeight)
                    prev.push(arr)
                    return prev
                }, [])
                mask.onclick = function (e) {
                    var findIndex;
                    for (var i = 0, len = getNodeArr.length; i < len; i++) {
                        if ((e.pageX >= getNodeArr[i][0] && e.pageX <= getNodeArr[i][2]) && (e.pageY >= getNodeArr[
                                i][1] && e.pageY <= getNodeArr[i][3])) {
                            findIndex = i;
                            break;
                        } else {
                            findIndex = -1
                        }
                    }
                    switch (findIndex) {
                        case 0:
                            break
                        case 1:
                            break
                        case 2:
                            break
                        case 3:
                            break
                        case 4:
                            break
                        case 5:
                            break
                        case 6:
                            break
                        case 7:
                            window.location.href = '../html/vip-charge.html'
                            break
                    }
                }
            }
            maskClick()
    </script>

</html>